var responseFromParent=false;var isDriftedDomain=false;function gameInstancePostRun(){gameInstance.Module.postRun.push(function(){gameInstance.logo.style.display=gameInstance.progress.style.display="none";gameInstance.container.firstChild.style.visibility="hidden";var loadingBox=document.getElementById('loading-box');gameInstance.container.firstChild.style.visibility="visible";loadingBox.remove();var fullscreenBtn=document.querySelector(".fullscreen");if(fullscreenBtn!==null){fullscreenBtn.style.visibility="visible";}
var bugBtn=document.querySelector(".bug");if(bugBtn!==null){bugBtn.style.visibility="visible";}
var installerBtn=document.getElementById("btn-installer");if(installerBtn!==null){installerBtn.style.visibility="visible";}
var categoryBtn=document.querySelector(".category");if(categoryBtn!==null){categoryBtn.style.visibility="visible";}});}
function bindVideoPreviews(container){var videoAnchor=container.querySelector("#up-sell a");videoAnchor.addEventListener("mouseover",function(){var theVideo=videoAnchor.querySelector('video');if(theVideo){theVideo.play();}});videoAnchor.addEventListener("mouseout",function(){var theVideo=videoAnchor.querySelector('video');if(theVideo){theVideo.pause();}});};function bindPlayNowButton(){var playNowButton=document.getElementById('play-now');if(playNowButton!==null){playNowButton.style.display="block";playNowButton.addEventListener('click',function(){if(fnEnablePrerollAds()){fnInitPreRollAds(playNowButton);}else{invokeGame();playNowButton.style.display="none";if(gameInstance){console.log('DEBUG: init game loader');gameInstancePostRun();}}});}};function setupManualPlay(){var container=document.getElementById("webgl-content");if(container){bindPlayNowButton();bindVideoPreviews(container);var playNowButton=document.getElementById('play-now');playNowButton.style.display="block";}};function fnEnablePrerollAds(){return document.body.classList.contains('enable-preroll-ads');};function fnInitPreRollAds(playNowButton){console.log('DEBUG: PREROLLAD - init pre-roll ad code');var prerollPlaceholder=document.getElementById('prerollPlaceholder');if(prerollPlaceholder!==null){prerollPlaceholder.style.display="block";getAdInPlayLib(playNowButton);}
window.aiptag=window.aiptag||{};aiptag.cmd=aiptag.cmd||[];aiptag.cmd.player=aiptag.cmd.player||[];aiptag.gdprShowConsentTool=false;aiptag.cmd.player.push(function(){console.log('DEBUG: PREROLLAD - execute pre-roll');adplayer=new aipPlayer({AD_WIDTH:960,AD_HEIGHT:574,AD_FULLSCREEN:false,AD_CENTERPLAYER:false,LOADING_TEXT:'Loading game advertisement',PREROLL_ELEM:function(){return document.getElementById('prerollPlaceholder');},AIP_COMPLETE:function(){playNowButton.style.display="none";console.log("DEBUG: PREROLLAD - pre-roll ad completed");invokeGame();if(gameInstance){console.log('DEBUG: PREROLLAD - init game loader');gameInstancePostRun();}},AIP_REMOVE:function(){console.log('DEBUG: PREROLLAD - delete preroll placeholder element');document.getElementById('prerollPlaceholder').remove();}});adplayer.startPreRoll();});getAdInPlayLib();};let adInPlayLibLoaded=false;function getAdInPlayLib(playNowButton){return new Promise(function(resolve,reject){if(adInPlayLibLoaded===false){const s=document.createElement('script');let r=false;s.type='text/javascript';s.src='//api.adinplay.com/libs/aiptag/pub/DFT/drifted.com/tag.min.js';s.async=true;s.onerror=function(err){reject(err,s);console.log("DEBUG: PREROLLAD - ad blocker detected, allow user to load game");playNowButton.style.display="none";console.log("DEBUG: PREROLLAD - pre-roll ad completed");invokeGame();console.log('DEBUG: PREROLLAD - delete preroll placeholder element');document.getElementById('prerollPlaceholder').remove();if(gameInstance){console.log('DEBUG: PREROLLAD - init game loader');gameInstancePostRun();}
var GAscript=document.createElement('script');GAscript.src="//www.googletagmanager.com/gtag/js?id=UA-11106352-23";document.head.appendChild(GAscript);window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('event','click',{'event_category':'Adblocker Pageview','event_label':window.location.href,'transport_type':'beacon','event_callback':function(){console.log("DEBUG: PREROLLAD - fire adblock event");}});};s.onload=s.onreadystatechange=function(){if(!r&&(!this.readyState||this.readyState=='complete')){r=true;resolve();}};const t=document.getElementsByTagName('script')[0];t.parentElement.insertBefore(s,t);adInPlayLibLoaded=!adInPlayLibLoaded;}});};if(window.self!==window.top){var url=(window.location!=window.parent.location)?document.referrer:document.location.href;isDriftedDomain=/^(drifted\.com)|(\.drifted.com)/.test(url);}
if(window.self!==window.top&&isDriftedDomain){window.addEventListener("message",function(msg){if(responseFromParent===true){return;}else{responseFromParent=true;}
var container=document.getElementById("webgl-content");if(container){if(msg.data.detail==="upsell"){var initialUpSell=document.getElementById('loading-box');if(initialUpSell){initialUpSell.remove();}
container.insertAdjacentHTML("beforeend",msg.data.markup);bindPlayNowButton();bindVideoPreviews(container);var playNowButton=document.getElementById('play-now');playNowButton.style.display="block";}
if(msg.data.detail==="show_pwa_button"){const butInstall=document.getElementById('btn-installer');if(butInstall&&msg.data.show===true){butInstall.classList.remove("hide");}}}else{invokeGame();}});setTimeout(function(){window.parent.postMessage("upsellMarkup");window.parent.postMessage("showPWAButton");setTimeout(function(){if(!responseFromParent){responseFromParent=true;setupManualPlay();}},100)},50);}else{document.addEventListener("DOMContentLoaded",function(){setupManualPlay();});var GAscript=document.createElement('script');GAscript.src="https://www.googletagmanager.com/gtag/js?id=UA-11106352-23";document.head.appendChild(GAscript);window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-11106352-23',{'content_group1':'Gaming Traffic'});gtag('event','click',{'event_category':'Game Pageview Without Wrapper','event_label':window.location.href,'transport_type':'beacon','event_callback':function(){}});window.addEventListener('load',(event)=>{if(document.body.classList.contains('drift-hunters')){const delayAmount=2500;setTimeout(fnInitAdThriveAds,delayAmount);}});function fnInitAdThriveAds(){document.body.classList.add("ads-enabled");(function(w,d){w.adthrive=w.adthrive||{};w.adthrive.cmd=w.adthrive.cmd||[];w.adthrive.plugin='adthrive-ads-1.0.43-manual';w.adthrive.host='ads.adthrive.com';var s=d.createElement('script');s.async=!0;s.referrerpolicy='no-referrer-when-downgrade';s.src='https://'+w.adthrive.host+'/sites/5ba533eb02763b77649ff1ee/ads.min.js?referrer='+w.encodeURIComponent(w.location.href);var n=d.getElementsByTagName('script')[0];n.parentNode.insertBefore(s,n);})(window,document);fnPreventAdThriveAdRotation=function(){setInterval(function(){const pages=['/media/games/dh/index.html'];const adThriveLoaded=document.getElementsByTagName('body')[0].classList.contains('adthrive-device-phone')||document.getElementsByTagName('body')[0].classList.contains('adthrive-device-tablet')||document.getElementsByTagName('body')[0].classList.contains('adthrive-device-desktop');if(!adThriveLoaded){console.log('Waiting for AdThrive...')
return}
pages.forEach(item=>{if(window.location.pathname===item){window.adthrive.slotManager.updateRefreshTimeout(window.adthrive.slots.get(),0);console.log('Disable AdThrive ad rotation');}});},1000);}
if(document.body.classList.contains('disable-ad-rotation')){setTimeout(fnPreventAdThriveAdRotation,5000);}}}
function fnInitPWAAppInstaller(){let deferredPrompt;const butInstall=document.getElementById('btn-installer');butInstall.addEventListener('click',(e)=>{window.parent.postMessage("pwa-install");});}